# TOM-246:dev:AI外联军师系统 (V6.0)

**模块**: AI工具开发  
**负责人**: Claude AI  
**完成日期**: 2025-08-05  
**状态**: ✅ 已完成 (V2.1洞察驱动升级)

---

## 🎯 设计概述 (Design Overview)

**设计目标**: 开发一个AI辅助的博主分析工具，支持混合输入模式，实现从视频链接/本地文件到个性化沟通脚本的完整自动化流程  
**技术范围**: 命令行Python工具，涵盖混合输入、音频处理、语音转录、AI分析、脚本生成五大核心模块  
**设计原则**: 混合输入策略、模块化设计、可配置Prompt、用户友好

### 核心设计决策 (V2.1.0)

1. **混合输入架构**: 采用`--url`和`--file`双输入模式，解决不同平台的兼容性问题
2. **音频处理核心**: 基于ffmpeg的统一音频提取和格式标准化，确保ASR转录的兼容性
3. **可配置Prompt**: 所有AI分析逻辑由外部Prompt模板文件驱动，便于快速优化迭代
4. **技术栈升级**: 使用Typer替代argparse，提供更现代的CLI开发体验
5. **智能缓存策略**: 基于源文件哈希的转录缓存，避免重复ASR调用，提高处理效率
6. **博主档案整合**: 支持基础信息文件解析，实现多维度博主分析和合作评估
7. **批量处理优化**: 智能去重和错误恢复机制，支持大规模文件批量处理
8. **🆕 洞察驱动分析**: 从"信息陈列"升级为"洞察驱动"，增加核心洞察与个性化沟通策略模块
9. **🆕 情感共鸣引擎**: AI深度分析博主内心需求、恐惧和渴望，生成"你懂我"瞬间连接

### 设计输出

- **技术方案**: 完整的五模块协作实现路径
- **架构设计**: 清晰的混合输入数据流和组件关系
- **实现计划**: 分阶段的开发步骤和里程碑
- **风险评估**: 平台兼容性、API限制、成本控制等风险应对

---

## 2. 主要实现内容

### 2.1 当前实现状态分析 (V2.1.0)

**✅ 已完成功能模块**：

**核心系统 (V1.0.0)**:
- 项目架构设计和技术选型确定 (V5.0)
- 混合输入模式设计和流程规划
- 详细的技术文档和规范制定
- 在线音频提取模块 (fetcher.py) - 含字幕提取功能
- 本地文件处理模块 (file_handler.py) - 含FFmpeg音频处理
- ASR转录模块 (transcriber.py) - 腾讯云API集成
- AI分析模块 (analyzer.py) - DeepSeek/OpenAI集成
- 脚本生成模块 (generator.py) - Jinja2模板引擎
- 主流程编排 (main.py with Typer) - 完整CLI实现
- Prompt模板文件 (prompts/) - 博主分析模板
- 沟通脚本模板 (templates/) - 个性化脚本模板
- 完整的单元测试和集成测试
- 端到端功能验证和真实API测试

**批量处理系统 (V1.1.0)**:
- 批量文件处理模块 - 支持文件夹级别的MP4批量分析
- 智能去重机制 - 自动检测和跳过已处理文件
- 转录文本独立保存 - 输出到专用transcripts目录
- 进度跟踪和统计报告 - 实时显示处理状态

**博主综合分析系统 (V1.2.0)**:
- 博主分析器模块 (blogger_analyzer.py) - 整合基础信息和视频内容
- 音频转录缓存系统 (transcript_cache.py) - 基于MD5哈希的智能缓存
- 博主综合分析模板 (blogger_comprehensive_template.md) - 全面的分析报告
- YAML front matter解析 - 自动提取博主基础信息
- 多视频内容整合分析 - 生成统一的博主档案
- CLI命令扩展 (blogger-analysis) - 新增综合分析命令

**洞察驱动分析系统 (V2.1.0)**:
- 核心洞察分析模块 - 深度挖掘博主内心世界和情感驱动
- 个性化沟通策略生成 - AI生成独特的"你懂我"沟通方案
- 情感共鸣引擎 - 分析博主恐惧、渴望、自豪等深层情感
- 优化的分析Prompt (analyze_blogger_content_v2.txt) - 增加洞察和策略字段
- 报告结构优化 - 核心洞察置顶，从信息陈列转为洞察驱动
- JSON解析增强 - 支持新的洞察字段和错误恢复机制

### 2.2 技术架构决策

**当前项目结构** (V2.1.0):

```text
creator-compass/
├── main.py                    # 🎯 主流程入口 (Typer CLI)
├── src/                       # 📦 源代码目录
│   └── ai_outreach/           # 核心包
│       ├── __init__.py        # 包初始化文件
│       ├── fetcher.py         # 在线抓取模块 (yt-dlp封装+字幕提取)
│       ├── file_handler.py    # 本地文件处理模块
│       ├── transcriber.py     # ASR转录模块 (腾讯云ASR封装+缓存)
│       ├── analyzer.py        # AI分析模块 (LLM API + Prompt模板)
│       ├── generator.py       # 脚本生成模块 (Jinja2封装)
│       ├── blogger_analyzer.py # 🆕 博主综合分析模块
│       ├── transcript_cache.py # 🆕 音频转录缓存模块
│       └── utils/             # 工具函数目录
│           ├── __init__.py    # 工具包初始化
│           ├── config.py      # 配置管理
│           ├── logger.py      # 日志工具
│           ├── exceptions.py  # 自定义异常
│           └── audio_utils.py # 音频处理工具
├── prompts/                   # 🧠 AI分析Prompt模板目录
│   ├── analyze_blogger_content.txt
│   ├── analyze_blogger_content_v2.txt # 🆕 洞察驱动分析模板
│   └── extract_pain_points.txt
├── templates/                 # 📝 沟通脚本模板目录
│   ├── new_blogger_template.md     # 新锐博主破冰脚本
│   ├── new_blogger_template_v2.md  # 🆕 V2.0 洞察驱动脚本模板
│   ├── known_blogger_template.md   # 旧识博主激活脚本
│   ├── known_blogger_template_v2.md # 🆕 V2.0 洞察驱动脚本模板
│   └── blogger_comprehensive_template.md # 博主综合分析报告模板
├── tests/                     # 🧪 测试文件目录
│   ├── test_*.py             # 单元测试和集成测试
│   └── __init__.py
├── outputs/                   # 📊 输出报告目录
│   ├── cache/                 # 🆕 缓存目录
│   │   └── transcripts/       # 音频转录缓存
│   └── transcripts/           # 📝 转录文本专用目录
├── temp/                      # 🗂️ 临时文件目录
├── docs/                      # 📚 项目文档
│   ├── 项目 - AI外联军师.md
│   ├── 架构 - AI外联军师.md (V5.0)
│   ├── 决策 - AI外联军师技术选型.md
│   └── development/           # 开发文档
├── requirements.txt           # 📋 Python依赖清单
├── .env.example              # ⚙️ 环境变量模板
└── README.md                 # 📖 项目说明文档
```

---

## 🎉 项目当前状态 (V2.1.0)

**✅ 已完成功能模块**:

### 核心功能 (V1.0.0)
- ✅ 混合输入模式：支持URL链接和本地文件处理
- ✅ 智能字幕提取：URL模式优先字幕，回退音频处理
- ✅ 音频转录系统：腾讯云ASR集成，支持长短音频
- ✅ AI内容分析：DeepSeek/OpenAI模型集成
- ✅ 个性化脚本生成：3种风格沟通脚本自动生成
- ✅ 完整CLI界面：Typer框架，用户友好体验

### 批量处理功能 (V1.1.0)
- ✅ 批量文件处理：支持文件夹内多个MP4批量分析
- ✅ 智能去重机制：自动跳过已处理文件
- ✅ 转录文本保存：独立转录文本输出功能
- ✅ 进度跟踪显示：实时处理进度和统计报告

### 博主综合分析功能 (V1.2.0)
- ✅ 博主档案解析：支持"人物-博主名.md"基础信息提取
- ✅ 多视频内容整合：生成博主综合分析报告
- ✅ 合作评估报告：多维度博主特征和合作可行性分析
- ✅ 音频转录缓存：基于源文件哈希的智能缓存系统

### 洞察驱动分析功能 (V2.1.0)
- ✅ 核心洞察分析：深度挖掘博主内心需求、恐惧和渴望
- ✅ 独特切入角度：AI生成最能让博主感到"你懂我"的沟通角度
- ✅ 个性化沟通策略：包含开场话术、共鸣建立、价值展示、后续策略的完整方案
- ✅ 报告结构优化：核心洞察置顶，从信息陈列转为洞察驱动
- ✅ 情感共鸣引擎：分析博主深层情感驱动因素

**🚀 最新实现亮点 (V2.1.0)**:

- **洞察驱动分析**: 从"信息陈列"升级为"洞察驱动"，AI深度分析博主内心世界
- **情感共鸣引擎**: 分析博主恐惧、渴望、自豪等深层情感，生成"你懂我"连接点
- **个性化策略生成**: AI生成完整的个性化沟通策略，包含具体的开场话术和后续行动
- **独特切入角度**: 回答"从哪个最独特的角度切入让博主感觉你是知己"的核心问题
- **报告结构优化**: 核心洞察置顶展示，突出战略价值而非信息罗列

**前期实现亮点 (V1.2.0)**:
- **音频转录缓存**: 基于MD5哈希的智能缓存机制，避免重复ASR调用
- **博主综合分析**: 整合基础信息和多个视频内容，生成全面的博主档案
- **YAML解析支持**: 自动解析博主基础信息文件的front matter
- **智能文件命名**: 从路径和文件名自动提取博主身份信息
- **缓存管理系统**: 完整的缓存索引、清理和统计功能

---

## 🚀 功能开发历程

### V2.1.0 (2025-08-05)
**洞察驱动分析系统升级**
- ✅ 优化AI分析Prompt，增加核心洞察、独特切入角度、个性化沟通策略三大新字段
- ✅ 升级`AnalysisResult`类，支持`core_insights`、`unique_approach`、`personalized_strategy`字段
- ✅ 重构报告生成器，核心洞察置顶，从信息陈列转为洞察驱动结构
- ✅ 增强JSON解析错误处理，支持新字段的回退数据提取
- ✅ 创建测试脚本验证洞察驱动分析效果，实现"你懂我"瞬间连接目标
- ✅ 系统从"信息分析师"升级为"战略沟通顾问"，深度理解博主内心需求

**实现位置**:
- `prompts/analyze_blogger_content_v2.txt` - 洞察驱动分析模板
- `src/ai_outreach/analyzer.py` - 升级支持洞察字段
- `src/ai_outreach/generator.py` - 报告结构优化
- `test_insights.py` - 洞察驱动分析验证脚本

### V5.0 (2025-08-11)
**单点验证脚本与防模板化强化**

- ✅ 最优破冰脚本升级为“V5.0 单点验证”版本：从泛泛“求教”转为“快速验证新核心痛点假设”
  - Prompt：`prompts/analyze_blogger_comprehensive_v3.txt` 增强生成约束（LMW自我介绍、旧假设A→新假设B、场景括号化锚定、唯一判断问题、非推销声明、轻量方法论背书）
  - 模板：`templates/blogger_comprehensive_template_V2.md` 标题与目标说明更新为 V5.0 单点验证
- ✅ 防模板化与脚本兜底：新增运行期 Sanitizer，自动检测占位符/示例文本，重写为个性化单段落脚本
  - 位置：`src/ai_outreach/analyzer.py::_sanitize_outreach_script`
  - 逻辑：注入金句/主题/痛点至少各1项（如可用），补齐“LMW”与轻量方法论背书；无效时重写

备注：上述改动保持字段名不变，与既有测试兼容；若模型输出异常，兜底逻辑保证可用脚本生成。

### V1.2.0 (2025-08-05)
**博主综合分析功能**
- ✅ 实现 `BloggerAnalyzer` 类，支持整合博主基础信息和多个视频内容
- ✅ 支持 "人物 - 博主名.md" 文件自动解析，提取博主基础信息（YAML front matter）
- ✅ 新增 `blogger-analysis` CLI命令，生成综合分析报告
- ✅ 创建博主综合分析报告模板 (`blogger_comprehensive_template.md`)
- ✅ 实现音频转录缓存系统，避免重复ASR调用
- ✅ 添加 `TranscriptCache` 类，基于源文件哈希的智能缓存机制

**实现位置**:
- `src/ai_outreach/blogger_analyzer.py` - 博主综合分析核心逻辑
- `src/ai_outreach/transcript_cache.py` - 音频转录缓存系统
- `templates/blogger_comprehensive_template.md` - 综合分析报告模板
- `main.py` - 新增 `blogger-analysis` 命令和缓存集成

### V1.1.0 (2025-08-05)
**批量处理功能**
- ✅ 实现批量处理MP4文件功能 (`batch` 命令)
- ✅ 智能去重机制，自动跳过已处理文件
- ✅ 转录文本独立保存功能
- ✅ 进度追踪和详细统计报告
- ✅ 错误恢复机制，单文件失败不影响整体任务

### V1.0.0 (2025-08-04)
**核心功能实现**
- ✅ 混合输入模式：`--url` 和 `--file` 双输入支持
- ✅ 在线抓取模块：yt-dlp + 字幕提取优先策略
- ✅ 本地文件处理：FFmpeg音频提取和格式处理
- ✅ ASR转录模块：腾讯云ASR API集成，支持长短音频
- ✅ AI分析模块：DeepSeek/OpenAI集成，可配置Prompt模板
- ✅ 脚本生成模块：Jinja2模板引擎，生成个性化沟通脚本
- ✅ 完整的CLI界面：Typer框架，用户友好的命令行体验

## 📝 开发文档更新记录

| 日期 | 更新内容 | 更新人 |
|------|----------|--------|
| 2025-08-11 | V5.0：最优破冰脚本改造为“单点验证”版本（直接验证新核心痛点假设）；更新 Prompt 与 V2 模板标题与说明 | Cursor AI |
| 2025-08-11 | 防模板化与脚本兜底：新增运行期 Sanitizer，禁止占位符/示例文本复制，自动重写为个性化单段落脚本 | Cursor AI |
| 2025-08-05 | 添加V2.1.0洞察驱动分析系统升级记录，核心洞察与个性化策略 | Claude |
| 2025-08-05 | V1.2.0博主综合分析和缓存系统功能记录 | Claude |
| 2025-08-05 | 记录音频转录缓存优化过程和实现细节 | Claude |
| 2025-08-04 | 创建V5.0开发文档，支持混合输入模式和Typer CLI | Cursor AI |
| 2025-08-04 | 项目完成，更新所有任务状态为已完成，添加实现亮点 | Cursor AI |
| 2025-08-04 | 优化代码目录结构，采用src/ai_outreach包结构，更新文档 | Cursor AI |

## 🎯 用户故事

**作为** 独立开发者  
**我希望** 能利用AI工具，快速分析目标博主的视频内容，并自动生成个性化的沟通脚本初稿  
**以便于** 我能以数倍的效率，与潜在的天使用户建立真诚、有效的首次联系

## ✅ 开发验收标准

- [x] 支持`--url`和`--file`两种输入模式（URL优先字幕提取，本地文件音频处理）
- [x] 能通过URL或本地文件成功提取音频并转录（腾讯云ASR验证通过）
- [x] 能调用LLM基于Prompt模板分析博主风格、痛点、契合点（DeepSeek API验证）
- [x] 能生成两套不重复的个性化沟通脚本（3种风格脚本：专业认可型、价值共鸣型、资源互助型）
- [x] 整个流程能在30秒内完成（实测约18秒完成完整分析）
- [x] 输出完整的Markdown格式策略简报（格式清晰，内容完整）
- [x] 支持批量处理多个视频文件（智能去重、进度跟踪）
- [x] 支持博主综合分析（整合基础信息和多个视频内容）
- [x] 实现音频转录缓存（避免重复ASR调用，提高处理效率）
- [x] 洞察驱动分析系统（深度分析博主内心需求、恐惧和渴望）
- [x] 个性化沟通策略生成（AI生成独特的"你懂我"沟通方案）
- [x] 核心洞察与独特切入角度（回答"如何让博主感觉你是知己"的问题）

## 🔧 技术实现细节

### 洞察驱动分析系统 (V2.1.0)
- **核心洞察算法**: AI深度分析博主言论背后的价值观念、情感驱动和内心需求
- **情感共鸣引擎**: 识别博主的恐惧、渴望、自豪等深层情感，找出共鸣触发点
- **独特切入角度**: 基于核心洞察生成最能让博主感到"你懂我"的沟通角度
- **个性化策略生成**: 包含开场话术、共鸣建立、价值展示、后续策略的完整方案
- **报告结构优化**: 核心洞察置顶展示，突出战略价值而非信息罗列
- **JSON字段扩展**: 新增`core_insights`、`unique_approach`、`personalized_strategy`字段

### 音频转录缓存系统
- **缓存策略**: 基于源视频文件的文件大小和修改时间生成MD5哈希作为缓存键
- **索引管理**: JSON格式的缓存索引文件，记录缓存元数据
- **存储结构**: `outputs/cache/transcripts/` 目录下存储缓存文件
- **缓存命中**: 优先使用源文件缓存，回退到音频文件缓存
- **自动清理**: 损坏缓存自动清理，支持手动清理所有缓存

### 博主综合分析
- **文件解析**: 支持YAML front matter格式的博主基础信息
- **多视频整合**: 自动分析文件夹内所有视频文件，生成综合报告
- **智能命名**: 从文件夹路径和文件名智能提取博主名称
- **合作评估**: 基于多维度数据生成合作可行性评估

### 代码规范

```bash
# 代码格式化
ruff format .

# 代码检查
ruff check .

# 类型检查
mypy .
```

### 测试覆盖

```bash
# 运行测试
pytest tests/

# 测试覆盖率
pytest --cov=. tests/
```

---

## 🔗 相关资源

- **Linear Issue**: [TOM-246] 【系统工具】搭建"AI外联军师"并升级沟通弹药
- **项目文档**:
  - [项目概述](../项目%20-%20AI外联军师.md)
  - [系统架构 V5.0](../架构%20-%20AI外联军师.md)
  - [技术选型](../决策%20-%20AI外联军师技术选型.md)
  - [用户流程图 V2.0](../设计%20-%20AI外联军师用户流程图.md)
- **代码仓库**: [GitHub - creator-compass](https://github.com/lmw-dev/creator-compass.git)